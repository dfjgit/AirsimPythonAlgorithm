# DQNå¥–åŠ±é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨å’Œè°ƒæ•´DQNè®­ç»ƒè¿‡ç¨‹ä¸­çš„å¥–åŠ±ç³»æ•°å’Œå‚æ•°ã€‚

---

## ğŸ“‹ é…ç½®æ–‡ä»¶ä½ç½®

**æ–‡ä»¶å**: `dqn_reward_config.json`  
**è·¯å¾„**: `AirsimAlgorithmPython/multirotor/DQN/dqn_reward_config.json`

---

## ğŸ¯ é…ç½®é¡¹è¯´æ˜

### 1. å¥–åŠ±ç³»æ•° (reward_coefficients)

è¿™äº›ç³»æ•°ç›´æ¥å½±å“DQNè®­ç»ƒè¿‡ç¨‹ä¸­çš„å¥–åŠ±å‡½æ•°ã€‚

| å‚æ•°å | é»˜è®¤å€¼ | è¯´æ˜ | å»ºè®®èŒƒå›´ |
|--------|--------|------|----------|
| `exploration_reward` | 1.0 | æ¯ä¸ªæ–°æ‰«æå•å…ƒæ ¼çš„å¥–åŠ±åˆ†æ•° | 0.5 - 5.0 |
| `collision_penalty` | 5.0 | æ— äººæœºé—´è·ç¦»è¿‡è¿‘çš„æƒ©ç½šåˆ†æ•° | 1.0 - 10.0 |
| `out_of_range_penalty` | 2.0 | è¶…å‡ºLeaderæ‰«æèŒƒå›´çš„æƒ©ç½šåˆ†æ•° | 1.0 - 5.0 |
| `smooth_movement_reward` | 0.1 | å¹³æ»‘ç§»åŠ¨çš„å°é¢å¥–åŠ± | 0.05 - 0.5 |

#### è°ƒæ•´å»ºè®®ï¼š

**æé«˜æ¢ç´¢æ•ˆç‡**ï¼š
```json
{
    "exploration_reward": 2.0,  // â†‘ å¢åŠ æ¢ç´¢å¥–åŠ±
    "collision_penalty": 3.0,   // â†“ é™ä½ç¢°æ’æƒ©ç½šï¼ˆå…è®¸æ›´æ¿€è¿›ï¼‰
}
```

**å¢å¼ºå®‰å…¨æ€§**ï¼š
```json
{
    "exploration_reward": 0.8,   // â†“ é™ä½æ¢ç´¢å¥–åŠ±
    "collision_penalty": 10.0,   // â†‘ æé«˜ç¢°æ’æƒ©ç½š
    "out_of_range_penalty": 5.0  // â†‘ æé«˜è¶Šç•Œæƒ©ç½š
}
```

**é¼“åŠ±å¹³æ»‘è¿åŠ¨**ï¼š
```json
{
    "smooth_movement_reward": 0.5  // â†‘ æé«˜å¹³æ»‘è¿åŠ¨å¥–åŠ±
}
```

---

### 2. é˜ˆå€¼å‚æ•° (thresholds)

è¿™äº›é˜ˆå€¼å®šä¹‰äº†ä½•æ—¶è§¦å‘å¥–åŠ±æˆ–æƒ©ç½šã€‚

| å‚æ•°å | é»˜è®¤å€¼ | å•ä½ | è¯´æ˜ | å»ºè®®èŒƒå›´ |
|--------|--------|------|------|----------|
| `collision_distance` | 2.0 | ç±³ | è§¦å‘ç¢°æ’æƒ©ç½šçš„æœ€å°è·ç¦» | 1.0 - 3.0 |
| `movement_min` | 0.5 | ç±³ | åˆç†ç§»åŠ¨çš„æœ€å°è·ç¦» | 0.3 - 1.0 |
| `movement_max` | 3.0 | ç±³ | åˆç†ç§»åŠ¨çš„æœ€å¤§è·ç¦» | 2.0 - 5.0 |
| `scanned_entropy_threshold` | 30 | - | åˆ¤æ–­å•å…ƒæ ¼å·²æ‰«æçš„ç†µå€¼é˜ˆå€¼ | 20 - 40 |
| `nearby_entropy_distance` | 10.0 | ç±³ | æŸ¥æ‰¾é™„è¿‘ç†µå€¼ä¿¡æ¯çš„è·ç¦» | 5.0 - 15.0 |

#### è°ƒæ•´å»ºè®®ï¼š

**æ›´ä¸¥æ ¼çš„ç¢°æ’æ£€æµ‹**ï¼š
```json
{
    "collision_distance": 3.0  // â†‘ æå‰è§¦å‘ç¢°æ’è­¦å‘Š
}
```

**å…è®¸æ›´å¿«é€Ÿç§»åŠ¨**ï¼š
```json
{
    "movement_min": 0.3,  // â†“ é™ä½æœ€å°ç§»åŠ¨è¦æ±‚
    "movement_max": 5.0   // â†‘ å…è®¸æ›´å¤§ç§»åŠ¨èŒƒå›´
}
```

**æ›´ç²¾ç¡®çš„æ‰«æåˆ¤å®š**ï¼š
```json
{
    "scanned_entropy_threshold": 20  // â†“ æ›´ä½çš„ç†µå€¼æ‰ç®—æ‰«æ
}
```

---

### 3. Episodeè®¾ç½® (episode)

| å‚æ•°å | é»˜è®¤å€¼ | è¯´æ˜ | å»ºè®®èŒƒå›´ |
|--------|--------|------|----------|
| `max_steps` | 200 | æ¯ä¸ªè®­ç»ƒepisodeçš„æœ€å¤§æ­¥æ•° | 100 - 500 |

#### è°ƒæ•´å»ºè®®ï¼š

**å¿«é€Ÿæµ‹è¯•**ï¼š
```json
{
    "max_steps": 100  // â†“ ç¼©çŸ­episodeï¼ŒåŠ å¿«è®­ç»ƒ
}
```

**é•¿æœŸè®­ç»ƒ**ï¼š
```json
{
    "max_steps": 500  // â†‘ å»¶é•¿episodeï¼Œå­¦ä¹ æ›´å¤æ‚ç­–ç•¥
}
```

---

### 4. åŠ¨ä½œç©ºé—´å‚æ•° (action_space)

è¿™äº›å‚æ•°æ§åˆ¶DQNè¾“å‡ºçš„æƒé‡èŒƒå›´å’Œå¹³æ»‘å¤„ç†ã€‚

| å‚æ•°å | é»˜è®¤å€¼ | è¯´æ˜ | å»ºè®®èŒƒå›´ |
|--------|--------|------|----------|
| `weight_min` | 0.5 | æƒé‡ç³»æ•°çš„æœ€å°å€¼ | 0.1 - 1.0 |
| `weight_max` | 5.0 | æƒé‡ç³»æ•°çš„æœ€å¤§å€¼ | 3.0 - 10.0 |
| `std_threshold` | 1.5 | è§¦å‘æƒé‡å¹³æ»‘çš„æ ‡å‡†å·®é˜ˆå€¼ | 1.0 - 2.5 |
| `std_smoothing` | 0.7 | æƒé‡å¹³æ»‘ç³»æ•° | 0.5 - 0.9 |
| `max_min_ratio` | 5 | æœ€å¤§æƒé‡ä¸æœ€å°æƒé‡çš„æœ€å¤§æ¯”ä¾‹ | 3 - 10 |

#### è°ƒæ•´å»ºè®®ï¼š

**å…è®¸æ›´å¤§æƒé‡å·®å¼‚**ï¼š
```json
{
    "weight_max": 10.0,      // â†‘ æé«˜æœ€å¤§æƒé‡
    "std_threshold": 2.5,    // â†‘ å‡å°‘å¹³æ»‘è§¦å‘
    "max_min_ratio": 10      // â†‘ å…è®¸æ›´å¤§æ¯”ä¾‹å·®
}
```

**å¼ºåˆ¶æƒé‡å‡è¡¡**ï¼š
```json
{
    "std_threshold": 1.0,    // â†“ æ›´å®¹æ˜“è§¦å‘å¹³æ»‘
    "std_smoothing": 0.5,    // â†“ æ›´å¼ºçš„å¹³æ»‘
    "max_min_ratio": 3       // â†“ é™åˆ¶æƒé‡å·®å¼‚
}
```

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. ä¿®æ”¹é…ç½®æ–‡ä»¶

ç›´æ¥ç¼–è¾‘ `dqn_reward_config.json`ï¼š

```json
{
    "reward_coefficients": {
        "exploration_reward": 2.0,    // ä¿®æ”¹è¿™é‡Œ
        "collision_penalty": 5.0,
        ...
    },
    ...
}
```

### 2. åœ¨ä»£ç ä¸­ä½¿ç”¨

é…ç½®ä¼šè‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€é¢å¤–ä»£ç ï¼š

```python
# åˆ›å»ºç¯å¢ƒæ—¶è‡ªåŠ¨åŠ è½½é…ç½®
env = SimpleWeightEnv(server=server, drone_name="UAV1")

# æˆ–æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
env = SimpleWeightEnv(
    server=server, 
    drone_name="UAV1",
    reward_config_path="custom_config.json"
)
```

### 3. ç¨‹åºåŒ–ä¿®æ”¹é…ç½®

```python
from dqn_reward_config_data import DQNRewardConfig

# åŠ è½½é…ç½®
config = DQNRewardConfig("dqn_reward_config.json")

# ä¿®æ”¹å‚æ•°
config.exploration_reward = 2.0
config.collision_penalty = 10.0

# ä¿å­˜æ–°é…ç½®
config.save_to_file("dqn_reward_config_modified.json")

# æŸ¥çœ‹é…ç½®
print(config)
```

---

## ğŸ“ è°ƒå‚ç­–ç•¥

### é˜¶æ®µ1: åˆæœŸè®­ç»ƒï¼ˆå…³æ³¨æ¢ç´¢ï¼‰

```json
{
    "reward_coefficients": {
        "exploration_reward": 3.0,      // é«˜æ¢ç´¢å¥–åŠ±
        "collision_penalty": 2.0,       // ä½ç¢°æ’æƒ©ç½š
        "out_of_range_penalty": 1.0,    // ä½è¶Šç•Œæƒ©ç½š
        "smooth_movement_reward": 0.05
    }
}
```

**ç›®æ ‡**: é¼“åŠ±æ— äººæœºå¤§èƒ†æ¢ç´¢ï¼Œå¿«é€Ÿå­¦ä¹ ç¯å¢ƒ

---

### é˜¶æ®µ2: ä¸­æœŸè®­ç»ƒï¼ˆå¹³è¡¡æ¢ç´¢ä¸å®‰å…¨ï¼‰

```json
{
    "reward_coefficients": {
        "exploration_reward": 1.5,
        "collision_penalty": 5.0,       // å¢åŠ ç¢°æ’æƒ©ç½š
        "out_of_range_penalty": 2.0,
        "smooth_movement_reward": 0.2   // å¢åŠ å¹³æ»‘å¥–åŠ±
    }
}
```

**ç›®æ ‡**: åœ¨æ¢ç´¢å’Œå®‰å…¨ä¹‹é—´å–å¾—å¹³è¡¡

---

### é˜¶æ®µ3: åæœŸè®­ç»ƒï¼ˆå…³æ³¨ç²¾ç»†åŒ–ï¼‰

```json
{
    "reward_coefficients": {
        "exploration_reward": 1.0,
        "collision_penalty": 10.0,      // é«˜ç¢°æ’æƒ©ç½š
        "out_of_range_penalty": 5.0,    // é«˜è¶Šç•Œæƒ©ç½š
        "smooth_movement_reward": 0.5   // é«˜å¹³æ»‘å¥–åŠ±
    },
    "thresholds": {
        "scanned_entropy_threshold": 20  // æ›´ä¸¥æ ¼çš„æ‰«ææ ‡å‡†
    }
}
```

**ç›®æ ‡**: ç²¾ç»†åŒ–ç­–ç•¥ï¼Œæé«˜å®‰å…¨æ€§å’Œæ•ˆç‡

---

## ğŸ“Š å¸¸è§é—®é¢˜

### Q1: æ— äººæœºæ€»æ˜¯ç¢°æ’ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: æé«˜ç¢°æ’æƒ©ç½šå’Œç¢°æ’è·ç¦»
```json
{
    "collision_penalty": 10.0,
    "collision_distance": 3.0
}
```

### Q2: æ— äººæœºæ¢ç´¢æ•ˆç‡ä½ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: æé«˜æ¢ç´¢å¥–åŠ±ï¼Œé™ä½å…¶ä»–æƒ©ç½š
```json
{
    "exploration_reward": 3.0,
    "collision_penalty": 2.0,
    "out_of_range_penalty": 1.0
}
```

### Q3: æ— äººæœºè¿åŠ¨ä¸ç¨³å®šï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: å¢åŠ å¹³æ»‘è¿åŠ¨å¥–åŠ±ï¼Œè°ƒæ•´è¿åŠ¨èŒƒå›´
```json
{
    "smooth_movement_reward": 0.5,
    "movement_min": 0.5,
    "movement_max": 2.0
}
```

### Q4: æƒé‡å·®å¼‚è¿‡å¤§å¯¼è‡´è¡Œä¸ºå¤±è¡¡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: æ”¶ç´§æƒé‡æ§åˆ¶å‚æ•°
```json
{
    "action_space": {
        "std_threshold": 1.0,
        "std_smoothing": 0.5,
        "max_min_ratio": 3
    }
}
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é€æ­¥è°ƒæ•´**: æ¯æ¬¡åªä¿®æ”¹1-2ä¸ªå‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœåå†ç»§ç»­
2. **ä¿ç•™å¤‡ä»½**: ä¿®æ”¹å‰å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶
3. **è®°å½•å®éªŒ**: è®°å½•æ¯æ¬¡ä¿®æ”¹å’Œå¯¹åº”çš„è®­ç»ƒç»“æœ
4. **é‡å¯è®­ç»ƒ**: ä¿®æ”¹é…ç½®åéœ€è¦é‡æ–°è®­ç»ƒæ¨¡å‹
5. **éªŒè¯æ•ˆæœ**: ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯æ–°é…ç½®çš„æ•ˆæœ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [DQNä¸»æ–‡æ¡£](README.md)
- [è®­ç»ƒè„šæœ¬](train_simple.py)
- [æµ‹è¯•è„šæœ¬](test_trained_model.py)
- [æƒé‡å¹³è¡¡è¯´æ˜](WEIGHT_BALANCING.md)

---

**æœ€åæ›´æ–°**: 2025-10-13

