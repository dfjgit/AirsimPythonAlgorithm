# è®­ç»ƒå¯è§†åŒ–å™¨ - å›¾è¡¨é¢„è§ˆåŠŸèƒ½ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

è®­ç»ƒå¯è§†åŒ–å™¨ç°åœ¨æ”¯æŒç”Ÿæˆç»Ÿè®¡å›¾è¡¨ï¼Œå¹¶åœ¨ä¿å­˜å‰æä¾›é¢„è§ˆåŠŸèƒ½ï¼Œé¿å…ç”Ÿæˆä¸å¿…è¦çš„æ–‡ä»¶ã€‚

## æ–°å¢æ–¹æ³•

### `generate_training_charts(preview_before_save=True, auto_save=False)`

ç”Ÿæˆè®­ç»ƒç»Ÿè®¡å›¾è¡¨ï¼ŒåŒ…å«4ä¸ªå­å›¾ï¼š
1. **Episode å¥–åŠ±æ›²çº¿** - æ˜¾ç¤ºåŸå§‹å¥–åŠ±å’Œå¹³æ»‘å¥–åŠ±ï¼ˆMA-10ï¼‰
2. **æƒé‡ç³»æ•°å˜åŒ–** - æ˜¾ç¤º5ä¸ªAPFæƒé‡ç³»æ•°çš„å˜åŒ–å†å²
3. **Episode é•¿åº¦åˆ†å¸ƒ** - æ¯ä¸ªEpisodeçš„æ­¥æ•°ç»Ÿè®¡
4. **è®­ç»ƒé€Ÿç‡** - æ¯ç§’è®­ç»ƒæ­¥æ•°çš„å˜åŒ–

### å‚æ•°è¯´æ˜

- `preview_before_save` (bool): æ˜¯å¦åœ¨ä¿å­˜å‰æ˜¾ç¤ºé¢„è§ˆçª—å£
  - `True`: å…ˆæ˜¾ç¤ºmatplotlibçª—å£è®©ç”¨æˆ·æŸ¥çœ‹ï¼Œå…³é—­åè¯¢é—®æ˜¯å¦ä¿å­˜
  - `False`: ç›´æ¥ä¿å­˜ï¼Œä¸æ˜¾ç¤ºé¢„è§ˆ
  
- `auto_save` (bool): æ˜¯å¦è‡ªåŠ¨ä¿å­˜ï¼ˆä»…åœ¨preview_before_save=Trueæ—¶æœ‰æ•ˆï¼‰
  - `True`: æ˜¾ç¤ºé¢„è§ˆåè‡ªåŠ¨ä¿å­˜
  - `False`: æ˜¾ç¤ºé¢„è§ˆåè¯¢é—®ç”¨æˆ·æ˜¯å¦ä¿å­˜

### è¿”å›å€¼

- æˆåŠŸä¿å­˜ï¼šè¿”å›ä¿å­˜çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨
- æœªä¿å­˜/å–æ¶ˆï¼šè¿”å› `None`

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šé¢„è§ˆåæ‰‹åŠ¨ç¡®è®¤ï¼ˆæ¨èï¼‰

```python
from multirotor.DDPG_Weight.training_visualizer import TrainingVisualizer

# åœ¨è®­ç»ƒè„šæœ¬ä¸­
visualizer = TrainingVisualizer(server=server, env=env)

# è®­ç»ƒè¿‡ç¨‹ä¸­æ­£å¸¸æ›´æ–°æ•°æ®
# visualizer.update_training_stats(...)
# visualizer.update_weight_history(...)

# è®­ç»ƒç»“æŸåç”Ÿæˆå›¾è¡¨
saved_files = visualizer.generate_training_charts(
    preview_before_save=True,   # æ˜¾ç¤ºé¢„è§ˆçª—å£
    auto_save=False              # éœ€è¦ç”¨æˆ·ç¡®è®¤
)

if saved_files:
    print(f"å›¾è¡¨å·²ä¿å­˜åˆ°: {saved_files[0]}")
```

**ç”¨æˆ·ä½“éªŒ**ï¼š
1. å¼¹å‡ºmatplotlibçª—å£æ˜¾ç¤º4ä¸ªç»Ÿè®¡å›¾è¡¨
2. ç”¨æˆ·å¯ä»¥æ”¾å¤§ã€ç¼©å°ã€æŸ¥çœ‹è¯¦æƒ…
3. ç”¨æˆ·å…³é—­çª—å£åï¼Œæ§åˆ¶å°æç¤ºï¼š`æ˜¯å¦ä¿å­˜å›¾è¡¨ï¼Ÿè¾“å…¥ 'y' æˆ– 'yes' ä¿å­˜ï¼Œå…¶ä»–ä»»æ„é”®å–æ¶ˆ:`
4. è¾“å…¥ `y` ä¿å­˜ï¼Œè¾“å…¥å…¶ä»–é”®å–æ¶ˆ

### ç¤ºä¾‹2ï¼šé¢„è§ˆåè‡ªåŠ¨ä¿å­˜

```python
# é€‚åˆéœ€è¦å­˜æ¡£ä½†æƒ³å…ˆçœ‹ä¸€çœ¼çš„åœºæ™¯
saved_files = visualizer.generate_training_charts(
    preview_before_save=True,   # æ˜¾ç¤ºé¢„è§ˆ
    auto_save=True               # è‡ªåŠ¨ä¿å­˜
)
```

**ç”¨æˆ·ä½“éªŒ**ï¼š
1. å¼¹å‡ºé¢„è§ˆçª—å£
2. ç”¨æˆ·æŸ¥çœ‹å®Œæ¯•å…³é—­çª—å£åè‡ªåŠ¨ä¿å­˜
3. æ— éœ€æ‰‹åŠ¨ç¡®è®¤

### ç¤ºä¾‹3ï¼šä¸é¢„è§ˆç›´æ¥ä¿å­˜

```python
# é€‚åˆæ‰¹é‡è®­ç»ƒæˆ–CI/CDç¯å¢ƒ
saved_files = visualizer.generate_training_charts(
    preview_before_save=False   # ä¸é¢„è§ˆï¼Œç›´æ¥ä¿å­˜
)
```

**ç”¨æˆ·ä½“éªŒ**ï¼š
1. ä¸æ˜¾ç¤ºçª—å£
2. ç›´æ¥ç”ŸæˆPNGæ–‡ä»¶å¹¶ä¿å­˜

## è¾“å‡ºæ–‡ä»¶

### æ–‡ä»¶ä½ç½®
```
multirotor/DDPG_Weight/training_visualizer_logs/
â””â”€â”€ training_charts_YYYYMMDD_HHMMSS.png
```

### æ–‡ä»¶å†…å®¹
- åˆ†è¾¨ç‡ï¼š150 DPI
- æ ¼å¼ï¼šPNG
- å°ºå¯¸ï¼š14Ã—10 è‹±å¯¸ï¼ˆçº¦ 2100Ã—1500 åƒç´ ï¼‰
- å¸ƒå±€ï¼š2è¡Œ2åˆ—ï¼Œ4ä¸ªå­å›¾

## å›¾è¡¨è¯´æ˜

### 1. Episode å¥–åŠ±æ›²çº¿ï¼ˆå·¦ä¸Šï¼‰
- è“è‰²é€æ˜çº¿ï¼šåŸå§‹å¥–åŠ±
- çº¢è‰²å®çº¿ï¼šå¹³æ»‘å¥–åŠ±ï¼ˆ10ä¸ªEpisodeçš„ç§»åŠ¨å¹³å‡ï¼‰
- ç»¿è‰²è™šçº¿ï¼šå¹³å‡å¥–åŠ±
- **ç”¨é€”**ï¼šåˆ¤æ–­è®­ç»ƒæ”¶æ•›æƒ…å†µ

### 2. æƒé‡ç³»æ•°å˜åŒ–ï¼ˆå³ä¸Šï¼‰
- 5æ¡ä¸åŒé¢œè‰²çš„æ›²çº¿ä»£è¡¨5ä¸ªAPFæƒé‡ç³»æ•°
- æ˜¾ç¤ºæƒé‡éšè®­ç»ƒçš„æ¼”åŒ–è¿‡ç¨‹
- **ç”¨é€”**ï¼šåˆ†æç®—æ³•å¦‚ä½•è°ƒæ•´æƒé‡ç­–ç•¥

### 3. Episode é•¿åº¦åˆ†å¸ƒï¼ˆå·¦ä¸‹ï¼‰
- æŸ±çŠ¶å›¾æ˜¾ç¤ºæ¯ä¸ªEpisodeçš„æ­¥æ•°
- çº¢è‰²è™šçº¿ï¼šå¹³å‡é•¿åº¦
- **ç”¨é€”**ï¼šåˆ¤æ–­Episodeç»ˆæ­¢æ¡ä»¶çš„åˆç†æ€§

### 4. è®­ç»ƒé€Ÿç‡ï¼ˆå³ä¸‹ï¼‰
- ç»¿è‰²æ›²çº¿æ˜¾ç¤ºè®­ç»ƒé€Ÿåº¦ï¼ˆæ­¥/ç§’ï¼‰
- çº¢è‰²è™šçº¿ï¼šå¹³å‡é€Ÿç‡
- **ç”¨é€”**ï¼šç›‘æ§è®­ç»ƒæ•ˆç‡ï¼Œå‘ç°æ€§èƒ½ç“¶é¢ˆ

## åœ¨è®­ç»ƒè„šæœ¬ä¸­é›†æˆ

### æ–¹æ³•1ï¼šè®­ç»ƒç»“æŸæ—¶è°ƒç”¨

```python
# train_with_airsim_improved.py ç¤ºä¾‹

def main():
    # ... è®­ç»ƒåˆå§‹åŒ– ...
    visualizer = TrainingVisualizer(server=server, env=env)
    
    try:
        # è®­ç»ƒå¾ªç¯
        for episode in range(total_episodes):
            # ... è®­ç»ƒä»£ç  ...
            visualizer.update_training_stats(...)
            visualizer.update_weight_history(...)
        
        # è®­ç»ƒç»“æŸï¼Œç”Ÿæˆå›¾è¡¨
        print("\nğŸ¨ è®­ç»ƒå®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆç»Ÿè®¡å›¾è¡¨...")
        visualizer.generate_training_charts(
            preview_before_save=True,
            auto_save=False
        )
        
    except KeyboardInterrupt:
        print("\nâš ï¸ è®­ç»ƒè¢«ä¸­æ–­")
        # å³ä½¿ä¸­æ–­ä¹Ÿå¯ä»¥ç”Ÿæˆå›¾è¡¨
        visualizer.generate_training_charts(
            preview_before_save=True,
            auto_save=False
        )
```

### æ–¹æ³•2ï¼šå®šæœŸç”Ÿæˆï¼ˆä¸æ¨èï¼‰

```python
# æ¯Nä¸ªepisodeç”Ÿæˆä¸€æ¬¡ï¼ˆä¼šäº§ç”Ÿå¤§é‡æ–‡ä»¶ï¼Œä¸æ¨èï¼‰
if episode % 50 == 0:
    visualizer.generate_training_charts(
        preview_before_save=False  # è‡ªåŠ¨ä¿å­˜
    )
```

## å¸¸è§é—®é¢˜

### Q1ï¼šå›¾è¡¨æ˜¾ç¤ºä¹±ç æ€ä¹ˆåŠï¼Ÿ
Aï¼šéƒ¨åˆ†emojiç¬¦å·å¯èƒ½åœ¨SimHeiå­—ä½“ä¸­ç¼ºå¤±ï¼Œè¿™ä¸å½±å“åŠŸèƒ½ï¼Œåªæ˜¯æ ‡é¢˜ä¸­çš„emojiä¼šæ˜¾ç¤ºä¸ºæ–¹æ¡†ã€‚

### Q2ï¼šå¯ä»¥åŒæ—¶ç”Ÿæˆå¤šä¸ªå›¾è¡¨å—ï¼Ÿ
Aï¼šæ¯æ¬¡è°ƒç”¨ `generate_training_charts()` ç”Ÿæˆä¸€ä¸ªPNGæ–‡ä»¶ï¼ŒåŒ…å«4ä¸ªå­å›¾ã€‚å¦‚æœéœ€è¦åˆ†å¼€ä¿å­˜ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨ã€‚

### Q3ï¼šå¦‚ä½•é¿å…é‡å¤ä¿å­˜ï¼Ÿ
Aï¼šä½¿ç”¨ `preview_before_save=True` å’Œ `auto_save=False`ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥å†³å®šæ˜¯å¦ä¿å­˜ã€‚

### Q4ï¼šè®­ç»ƒä¸­æ–­åè¿˜èƒ½ç”Ÿæˆå›¾è¡¨å—ï¼Ÿ
Aï¼šå¯ä»¥ï¼åªè¦ `visualizer` å¯¹è±¡è¿˜åœ¨å†…å­˜ä¸­ï¼Œå°±å¯ä»¥è°ƒç”¨ `generate_training_charts()`ã€‚

## æµ‹è¯•è„šæœ¬

è¿è¡Œæµ‹è¯•è„šæœ¬æŸ¥çœ‹æ•ˆæœï¼š
```bash
python multirotor/DDPG_Weight/test_chart_preview.py
```

æµ‹è¯•è„šæœ¬ä¼šï¼š
1. ç”Ÿæˆ30ä¸ªepisodeçš„æ¨¡æ‹Ÿæ•°æ®
2. æ˜¾ç¤ºé¢„è§ˆçª—å£
3. æ¼”ç¤ºæ‰‹åŠ¨ç¡®è®¤ä¿å­˜æµç¨‹

## æŠ€æœ¯ç»†èŠ‚

- **ä¸­æ–‡å­—ä½“æ”¯æŒ**ï¼šè‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿå¹¶é…ç½®åˆé€‚çš„ä¸­æ–‡å­—ä½“
- **æ•°æ®è¦æ±‚**ï¼šè‡³å°‘éœ€è¦1ä¸ªå®Œæ•´çš„Episodeæ•°æ®
- **å†…å­˜ç®¡ç†**ï¼šæ¯æ¬¡è°ƒç”¨åè‡ªåŠ¨å…³é—­matplotlib figureé‡Šæ”¾å†…å­˜
- **çº¿ç¨‹å®‰å…¨**ï¼šæ”¯æŒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è°ƒç”¨ï¼ˆåªè¦ä¸åŒæ—¶æ“ä½œåŒä¸€ä¸ªvisualizerå®ä¾‹ï¼‰
